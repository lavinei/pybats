---

title: Define Models


keywords: fastai
sidebar: home_sidebar

summary: "This module contains helper functions to define a DGLM, DCMM, or DBCM. They use the first several observations of a time series to initialize the model by treating them as static generalized linear models. These functions are called automatically when running a PyBATS analysis."
description: "This module contains helper functions to define a DGLM, DCMM, or DBCM. They use the first several observations of a time series to initialize the model by treating them as static generalized linear models. These functions are called automatically when running a PyBATS analysis."
nb_path: "nbs/03_define_models.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/03_define_models.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Define-a-DGLM">Define a DGLM<a class="anchor-link" href="#Define-a-DGLM"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="define_dglm" class="doc_header"><code>define_dglm</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/define_models.py#L18" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>define_dglm</code>(<strong><code>Y</code></strong>, <strong><code>X</code></strong>, <strong><code>family</code></strong>=<em><code>'normal'</code></em>, <strong><code>n</code></strong>=<em><code>None</code></em>, <strong><code>ntrend</code></strong>=<em><code>1</code></em>, <strong><code>nlf</code></strong>=<em><code>0</code></em>, <strong><code>nhol</code></strong>=<em><code>0</code></em>, <strong><code>seasPeriods</code></strong>=<em><code>[7]</code></em>, <strong><code>seasHarmComponents</code></strong>=<em><code>[[1, 2, 3]]</code></em>, <strong><code>deltrend</code></strong>=<em><code>0.995</code></em>, <strong><code>delregn</code></strong>=<em><code>0.995</code></em>, <strong><code>delseas</code></strong>=<em><code>0.999</code></em>, <strong><code>dellf</code></strong>=<em><code>0.999</code></em>, <strong><code>delVar</code></strong>=<em><code>0.999</code></em>, <strong><code>delhol</code></strong>=<em><code>1</code></em>, <strong><code>n0</code></strong>=<em><code>1</code></em>, <strong><code>s0</code></strong>=<em><code>1</code></em>, <strong><code>a0</code></strong>=<em><code>None</code></em>, <strong><code>R0</code></strong>=<em><code>None</code></em>, <strong><code>adapt_discount</code></strong>=<em><code>'info'</code></em>, <strong><code>discount_forecast</code></strong>=<em><code>False</code></em>, <strong><code>prior_length</code></strong>=<em><code>None</code></em>, <strong><code>return_aR</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>A helper function to define a DGLM.</p>
<p>This function is especially useful if you do not know how to specifify a prior mean and variance (a0, R0) for the state vector.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/pybats/define_models.html#define_dglm"><code>define_dglm</code></a> is a simple helper function to initialize a model. The primary arguments to pass in to <a href="/pybats/define_models.html#define_dglm"><code>define_dglm</code></a> are:</p>
<ul>
<li><code>Y</code> and <code>X</code>: The observations and predictors</li>
<li><code>family</code>: The observation family, which can be 'poisson', 'bernoulli', 'normal', or 'binomial'</li>
<li><code>prior_length</code>: The number of observations to use for defining the model</li>
</ul>
<p>You can pass in many other arguments, including anything accepted by <a href="/pybats/dglm.html#dglm.__init__"><code>dglm.__init__</code></a>, such as the number of trend components, the seasonal components, and the number of holidays. The number of regression predictors, <code>nregn</code>, is automatically inferred from the number of columns in <code>X</code>.</p>
<p>Below is a simple example of using <a href="/pybats/define_models.html#define_dglm"><code>define_dglm</code></a> to initialize a Poisson DGLM. In most PyBATS use cases, this function is called indirectly through <a href="/pybats/analysis.html"><code>analysis</code></a>. However, it can be useful to call directly to gain more control over customizing the model definition.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pybats.shared</span> <span class="kn">import</span> <span class="n">load_sales_example</span>
<span class="kn">from</span> <span class="nn">pybats.define_models</span> <span class="kn">import</span> <span class="n">define_dglm</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">load_sales_example</span><span class="p">()</span>             
<span class="n">Y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Advertising&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">define_dglm</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> 
                  <span class="n">family</span><span class="o">=</span><span class="s1">&#39;poisson&#39;</span><span class="p">,</span>             
                  <span class="n">prior_length</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span>              
                  <span class="n">ntrend</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>                     
                  <span class="n">nhol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>                       
                  <span class="n">seasPeriods</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>              
                  <span class="n">seasHarmComponents</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
                  <span class="p">)</span>

<span class="n">mod</span><span class="o">.</span><span class="n">get_coef</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mean</th>
      <th>Standard Deviation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>2.10</td>
      <td>0.15</td>
    </tr>
    <tr>
      <th>Regn 1</th>
      <td>0.06</td>
      <td>0.01</td>
    </tr>
    <tr>
      <th>Seas 1</th>
      <td>0.00</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>Seas 2</th>
      <td>0.00</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>Seas 3</th>
      <td>0.00</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>Seas 4</th>
      <td>0.00</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>Seas 5</th>
      <td>0.00</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>Seas 6</th>
      <td>0.00</td>
      <td>1.00</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="define_dlm_params" class="doc_header"><code>define_dlm_params</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/define_models.py#L163" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>define_dlm_params</code>(<strong><code>Y</code></strong>, <strong><code>X</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="define_bern_params" class="doc_header"><code>define_bern_params</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/define_models.py#L176" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>define_bern_params</code>(<strong><code>Y</code></strong>, <strong><code>X</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="define_bin_params" class="doc_header"><code>define_bin_params</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/define_models.py#L203" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>define_bin_params</code>(<strong><code>Y</code></strong>, <strong><code>n</code></strong>, <strong><code>X</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="define_pois_params" class="doc_header"><code>define_pois_params</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/define_models.py#L226" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>define_pois_params</code>(<strong><code>Y</code></strong>, <strong><code>X</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These functions are the core of <a href="/pybats/define_models.html#define_dglm"><code>define_dglm</code></a>. They take the first <code>prior_length</code> data points and fit a static, non-dynamic, generalized linear model (GLM), to initialize the DGLM.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Define-Combinations-of-DGLMs">Define Combinations of DGLMs<a class="anchor-link" href="#Define-Combinations-of-DGLMs"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="define_dcmm" class="doc_header"><code>define_dcmm</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/define_models.py#L259" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>define_dcmm</code>(<strong><code>Y</code></strong>, <strong><code>X</code></strong>, <strong><code>ntrend</code></strong>=<em><code>1</code></em>, <strong><code>nlf</code></strong>=<em><code>0</code></em>, <strong><code>nhol</code></strong>=<em><code>0</code></em>, <strong><code>rho</code></strong>=<em><code>1</code></em>, <strong><code>seasPeriods</code></strong>=<em><code>[7]</code></em>, <strong><code>seasHarmComponents</code></strong>=<em><code>[[1, 2, 3]]</code></em>, <strong><code>deltrend_bern</code></strong>=<em><code>0.995</code></em>, <strong><code>delregn_bern</code></strong>=<em><code>0.995</code></em>, <strong><code>delseas_bern</code></strong>=<em><code>0.995</code></em>, <strong><code>dellf_bern</code></strong>=<em><code>0.999</code></em>, <strong><code>delhol_bern</code></strong>=<em><code>1</code></em>, <strong><code>deltrend_pois</code></strong>=<em><code>0.998</code></em>, <strong><code>delregn_pois</code></strong>=<em><code>0.995</code></em>, <strong><code>delseas_pois</code></strong>=<em><code>0.995</code></em>, <strong><code>dellf_pois</code></strong>=<em><code>0.999</code></em>, <strong><code>delhol_pois</code></strong>=<em><code>1</code></em>, <strong><code>a0_bern</code></strong>=<em><code>None</code></em>, <strong><code>R0_bern</code></strong>=<em><code>None</code></em>, <strong><code>a0_pois</code></strong>=<em><code>None</code></em>, <strong><code>R0_pois</code></strong>=<em><code>None</code></em>, <strong><code>interpolate</code></strong>=<em><code>True</code></em>, <strong><code>adapt_discount</code></strong>=<em><code>False</code></em>, <strong><code>prior_length</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>A helper function to define a DCMM.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Dynamic Count Mixture Models are the combination of a Bernoulli and Poisson DGLM. <a href="/pybats/define_models.html#define_dcmm"><code>define_dcmm</code></a> is a convenient wrapper to help initialize both components of the <a href="/pybats/dcmm.html"><code>dcmm</code></a> together, and is called automatically by <a href="/pybats/analysis.html#analysis_dcmm"><code>analysis_dcmm</code></a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="define_dbcm" class="doc_header"><code>define_dbcm</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/define_models.py#L312" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>define_dbcm</code>(<strong><code>Y_transaction</code></strong>, <strong><code>X_transaction</code></strong>=<em><code>None</code></em>, <strong><code>Y_cascade</code></strong>=<em><code>None</code></em>, <strong><code>X_cascade</code></strong>=<em><code>None</code></em>, <strong><code>excess_baskets</code></strong>=<em><code>[]</code></em>, <strong><code>excess_values</code></strong>=<em><code>[]</code></em>, <strong><code>ntrend</code></strong>=<em><code>1</code></em>, <strong><code>nlf</code></strong>=<em><code>0</code></em>, <strong><code>nhol</code></strong>=<em><code>0</code></em>, <strong><code>rho</code></strong>=<em><code>1</code></em>, <strong><code>seasPeriods</code></strong>=<em><code>[7]</code></em>, <strong><code>seasHarmComponents</code></strong>=<em><code>[[1, 2, 3]]</code></em>, <strong><code>deltrend_bern</code></strong>=<em><code>0.995</code></em>, <strong><code>delregn_bern</code></strong>=<em><code>0.995</code></em>, <strong><code>delseas_bern</code></strong>=<em><code>0.995</code></em>, <strong><code>dellf_bern</code></strong>=<em><code>0.999</code></em>, <strong><code>delhol_bern</code></strong>=<em><code>1</code></em>, <strong><code>deltrend_pois</code></strong>=<em><code>0.998</code></em>, <strong><code>delregn_pois</code></strong>=<em><code>0.995</code></em>, <strong><code>delseas_pois</code></strong>=<em><code>0.995</code></em>, <strong><code>dellf_pois</code></strong>=<em><code>0.999</code></em>, <strong><code>delhol_pois</code></strong>=<em><code>1</code></em>, <strong><code>deltrend_cascade</code></strong>=<em><code>0.999</code></em>, <strong><code>delregn_cascade</code></strong>=<em><code>1.0</code></em>, <strong><code>delseas_cascade</code></strong>=<em><code>0.999</code></em>, <strong><code>dellf_cascade</code></strong>=<em><code>0.999</code></em>, <strong><code>delhol_cascade</code></strong>=<em><code>1.0</code></em>, <strong><code>a0_bern</code></strong>=<em><code>None</code></em>, <strong><code>R0_bern</code></strong>=<em><code>None</code></em>, <strong><code>a0_pois</code></strong>=<em><code>None</code></em>, <strong><code>R0_pois</code></strong>=<em><code>None</code></em>, <strong><code>a0_cascade</code></strong>=<em><code>None</code></em>, <strong><code>R0_cascade</code></strong>=<em><code>None</code></em>, <strong><code>interpolate</code></strong>=<em><code>True</code></em>, <strong><code>adapt_discount</code></strong>=<em><code>False</code></em>, <strong><code>prior_length</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>A helper function to define a DBCM.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Dynamic Binary Cascade Models are the combination of a DCMM and a cascade of binomial DGLMs. <a href="/pybats/define_models.html#define_dbcm"><code>define_dbcm</code></a> is a convenient wrapper to help initialize all of the components of a <a href="/pybats/dbcm.html"><code>dbcm</code></a> together, and is called automatically by <a href="/pybats/analysis.html#analysis_dbcm"><code>analysis_dbcm</code></a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="define_dlmm" class="doc_header"><code>define_dlmm</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/define_models.py#L424" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>define_dlmm</code>(<strong><code>Y</code></strong>, <strong><code>X</code></strong>, <strong><code>ntrend</code></strong>=<em><code>1</code></em>, <strong><code>nhol</code></strong>=<em><code>0</code></em>, <strong><code>rho</code></strong>=<em><code>1</code></em>, <strong><code>seasPeriods</code></strong>=<em><code>[7]</code></em>, <strong><code>seasHarmComponents</code></strong>=<em><code>[[1, 2, 3]]</code></em>, <strong><code>deltrend_bern</code></strong>=<em><code>0.995</code></em>, <strong><code>delregn_bern</code></strong>=<em><code>0.995</code></em>, <strong><code>delseas_bern</code></strong>=<em><code>0.995</code></em>, <strong><code>delhol_bern</code></strong>=<em><code>1</code></em>, <strong><code>deltrend_dlm</code></strong>=<em><code>0.998</code></em>, <strong><code>delregn_dlm</code></strong>=<em><code>0.995</code></em>, <strong><code>delseas_dlm</code></strong>=<em><code>0.995</code></em>, <strong><code>delhol_dlm</code></strong>=<em><code>1</code></em>, <strong><code>a0_bern</code></strong>=<em><code>None</code></em>, <strong><code>R0_bern</code></strong>=<em><code>None</code></em>, <strong><code>a0_dlm</code></strong>=<em><code>None</code></em>, <strong><code>R0_dlm</code></strong>=<em><code>None</code></em>, <strong><code>interpolate</code></strong>=<em><code>True</code></em>, <strong><code>adapt_discount</code></strong>=<em><code>False</code></em>, <strong><code>prior_length</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>A helper function to define a DLMM.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Dynamic Linear Mixture Models are the combination of a Bernoulli DGLM and a Normal DLM. <a href="/pybats/define_models.html#define_dlmm"><code>define_dlmm</code></a> is a convenient wrapper to help initialize both components of the <a href="/pybats/dlmm.html"><code>dlmm</code></a> together, and is called automatically by <a href="/pybats/analysis.html#analysis_dlmm"><code>analysis_dlmm</code></a>.</p>

</div>
</div>
</div>
</div>
 

