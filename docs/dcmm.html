---

title: DCMM


keywords: fastai
sidebar: home_sidebar

summary: "A Dynamic Count Mixture Model, or DCMM, is the combination of a Bernoulli and Poisson DGLM as described in <a href='https://arxiv.org/pdf/1805.05232.pdf'>Berry and West (2019)</a>."
description: "A Dynamic Count Mixture Model, or DCMM, is the combination of a Bernoulli and Poisson DGLM as described in <a href='https://arxiv.org/pdf/1805.05232.pdf'>Berry and West (2019)</a>."
nb_path: "nbs/11_dcmm.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/11_dcmm.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The DCMM is a combination of a Bernoulli and Poisson DGLM. The Bernoulli DGLM models the probability of the observation being zero. Conditional on a non-zero outcome, then the observation follows a Poisson distribution. This is useful for modeling time series with a greater number of zeros than expected under a Poisson distribution, which is frequently the case for low-valued count time series.</p>
<p>In more formal terms, a DCMM models observations $y_t$ as:
$$
\quad z_{t} \sim Bern(\pi_{t}) \quad \textrm{and}\quad y_{t} | z_{t}  = 
\begin{cases}
0, &amp; \text{if } z_{t} = 0,\\
1 + x_{t}, \quad x_{t} \sim Pois(\mu_{t}), &amp; \textrm{if}\ z_{t} = 1.
\end{cases}
$$</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="dcmm" class="doc_header"><code>class</code> <code>dcmm</code><a href="https://github.com/lavinei/pybats_nbdev/tree/master/pybats_nbdev/dcmm.py#L14" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>dcmm</code>(<strong><code>a0_bern</code></strong>=<em><code>None</code></em>, <strong><code>R0_bern</code></strong>=<em><code>None</code></em>, <strong><code>nregn_bern</code></strong>=<em><code>0</code></em>, <strong><code>ntrend_bern</code></strong>=<em><code>0</code></em>, <strong><code>nlf_bern</code></strong>=<em><code>0</code></em>, <strong><code>nhol_bern</code></strong>=<em><code>0</code></em>, <strong><code>seasPeriods_bern</code></strong>=<em><code>[]</code></em>, <strong><code>seasHarmComponents_bern</code></strong>=<em><code>[]</code></em>, <strong><code>deltrend_bern</code></strong>=<em><code>1</code></em>, <strong><code>delregn_bern</code></strong>=<em><code>1</code></em>, <strong><code>delhol_bern</code></strong>=<em><code>1</code></em>, <strong><code>delseas_bern</code></strong>=<em><code>1</code></em>, <strong><code>dellf_bern</code></strong>=<em><code>1</code></em>, <strong><code>a0_pois</code></strong>=<em><code>None</code></em>, <strong><code>R0_pois</code></strong>=<em><code>None</code></em>, <strong><code>nregn_pois</code></strong>=<em><code>0</code></em>, <strong><code>ntrend_pois</code></strong>=<em><code>0</code></em>, <strong><code>nlf_pois</code></strong>=<em><code>0</code></em>, <strong><code>nhol_pois</code></strong>=<em><code>0</code></em>, <strong><code>seasPeriods_pois</code></strong>=<em><code>[]</code></em>, <strong><code>seasHarmComponents_pois</code></strong>=<em><code>[]</code></em>, <strong><code>deltrend_pois</code></strong>=<em><code>1</code></em>, <strong><code>delregn_pois</code></strong>=<em><code>1</code></em>, <strong><code>delhol_pois</code></strong>=<em><code>1</code></em>, <strong><code>delseas_pois</code></strong>=<em><code>1</code></em>, <strong><code>dellf_pois</code></strong>=<em><code>1</code></em>, <strong><code>rho</code></strong>=<em><code>1</code></em>, <strong><code>interpolate</code></strong>=<em><code>True</code></em>, <strong><code>adapt_discount</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A DCMM can be used in the same way as a DGLM, with the standard methods <a href="/pybats_nbdev/dcmm.html#dcmm.update"><code>dcmm.update</code></a>, <a href="/pybats_nbdev/dcmm.html#dcmm.forecast_marginal"><code>dcmm.forecast_marginal</code></a>, and <a href="/pybats_nbdev/dcmm.html#dcmm.forecast_path"><code>dcmm.forecast_path</code></a>. There are equivalent helper functions as well. A full analysis can be run with <a href="/pybats_nbdev/analysis.html#analysis_dcmm"><code>analysis_dcmm</code></a>, and <a href="/pybats_nbdev/define_models.html#define_dcmm"><code>define_dcmm</code></a> helps to initialize a DCMM. These helper functions assume that the same predictors <code>X</code> are used for the Bernoulli and Poisson DGLMs.</p>
<p>The only difference from using a standard <a href="/pybats_nbdev/dglm.html"><code>dglm</code></a> is that outside of <a href="/pybats_nbdev/analysis.html#analysis_dcmm"><code>analysis_dcmm</code></a>, the update and forecast functions do not automatically recognize whether the DCMM includes latent factors or call a copula for path forecasting. This means that the modeler needs to be more explicit in calling the correct method, such as <a href="/pybats_nbdev/dcmm.html#dcmm.forecast_path_copula"><code>dcmm.forecast_path_copula</code></a> for path forecasting with a copula.</p>
<p>A quick example of using <a href="/pybats_nbdev/analysis.html#analysis_dcmm"><code>analysis_dcmm</code></a> to model simulated sales data follows. Another example with a DCMM can also be found <a href="https://github.com/lavinei/pybats_nbdev/blob/master/examples/DCMM%20Latent%20Factor%20Example.ipynb">here</a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pybats_nbdev.shared</span> <span class="kn">import</span> <span class="n">load_sales_example2</span>
<span class="kn">from</span> <span class="nn">pybats_nbdev.analysis</span> <span class="kn">import</span> <span class="n">analysis_dcmm</span>
<span class="kn">from</span> <span class="nn">pandas.tseries.holiday</span> <span class="kn">import</span> <span class="n">USFederalHolidayCalendar</span>


<span class="n">data</span> <span class="o">=</span> <span class="n">load_sales_example2</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Sales</th>
      <th>Price</th>
      <th>Promotion</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2014-06-01</th>
      <td>15.0</td>
      <td>1.11</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2014-06-02</th>
      <td>13.0</td>
      <td>2.19</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2014-06-03</th>
      <td>6.0</td>
      <td>0.23</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2014-06-04</th>
      <td>2.0</td>
      <td>-0.05</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2014-06-05</th>
      <td>6.0</td>
      <td>-0.14</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">prior_length</span> <span class="o">=</span> <span class="mi">25</span>   <span class="c1"># Number of days of data used to set prior</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">7</span>               <span class="c1"># Forecast horizon</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mf">0.5</span>           <span class="c1"># Random effect discount factor to increase variance of forecast distribution</span>
<span class="n">forecast_samps</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># Number of forecast samples to draw</span>
<span class="n">forecast_start</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">)</span> <span class="c1"># Date to start forecasting</span>
<span class="n">forecast_end</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2018-05-01&#39;</span><span class="p">)</span>   <span class="c1"># Date to stop forecasting</span>
<span class="n">holidays</span> <span class="o">=</span> <span class="n">USFederalHolidayCalendar</span><span class="o">.</span><span class="n">rules</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mod</span><span class="p">,</span> <span class="n">samples</span> <span class="o">=</span> <span class="n">analysis_dcmm</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Price&#39;</span><span class="p">,</span> <span class="s1">&#39;Promotion&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                             <span class="n">k</span><span class="p">,</span> <span class="n">forecast_start</span><span class="p">,</span> <span class="n">forecast_end</span><span class="p">,</span>
                             <span class="n">nsamps</span><span class="o">=</span><span class="n">forecast_samps</span><span class="p">,</span>
                             <span class="n">prior_length</span><span class="o">=</span><span class="n">prior_length</span><span class="p">,</span>
                             <span class="n">seasPeriods</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">seasHarmComponents</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
                             <span class="n">dates</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">holidays</span><span class="o">=</span><span class="n">holidays</span><span class="p">,</span>
                             <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span>
                             <span class="n">ret</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;forecast&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>beginning forecasting
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Because the DCMM is effectively a container for a Poisson and a Bernoulli DGLM, we can access each of them individually. The coefficients in the Bernoulli DGLM affect the probability of a non-zero observation, and the coefficients in the Poisson DGLM impact the size of any non-zero observations. To illustrate, we'll take a look at the holiday coefficients in both DGLMs.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pois_hol</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">pois_mod</span><span class="o">.</span><span class="n">get_coef</span><span class="p">(</span><span class="s1">&#39;hol&#39;</span><span class="p">)</span>
<span class="n">bern_hol</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">bern_mod</span><span class="o">.</span><span class="n">get_coef</span><span class="p">(</span><span class="s1">&#39;hol&#39;</span><span class="p">)</span>

<span class="n">coef</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Holidays&#39;</span><span class="p">:[</span><span class="n">h</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">holidays</span><span class="p">],</span>
                     <span class="s1">&#39;Pois Mean&#39;</span><span class="p">:</span> <span class="n">pois_hol</span><span class="p">[</span><span class="s1">&#39;Mean&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;Pois Std Dev&#39;</span><span class="p">:</span> <span class="n">pois_hol</span><span class="p">[</span><span class="s1">&#39;Standard Deviation&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;Bern Mean&#39;</span><span class="p">:</span> <span class="n">bern_hol</span><span class="p">[</span><span class="s1">&#39;Mean&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;Bern Std Dev&#39;</span><span class="p">:</span> <span class="n">bern_hol</span><span class="p">[</span><span class="s1">&#39;Standard Deviation&#39;</span><span class="p">]})</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">coef</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Holidays</th>
      <th>Pois Mean</th>
      <th>Pois Std Dev</th>
      <th>Bern Mean</th>
      <th>Bern Std Dev</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Hol 1</th>
      <td>New Years Day</td>
      <td>-0.94</td>
      <td>0.66</td>
      <td>-0.78</td>
      <td>1.29</td>
    </tr>
    <tr>
      <th>Hol 2</th>
      <td>Martin Luther King Jr. Day</td>
      <td>0.20</td>
      <td>0.43</td>
      <td>0.08</td>
      <td>1.41</td>
    </tr>
    <tr>
      <th>Hol 3</th>
      <td>Presidents Day</td>
      <td>-0.27</td>
      <td>0.46</td>
      <td>0.27</td>
      <td>1.39</td>
    </tr>
    <tr>
      <th>Hol 4</th>
      <td>Memorial Day</td>
      <td>0.62</td>
      <td>0.40</td>
      <td>0.04</td>
      <td>1.41</td>
    </tr>
    <tr>
      <th>Hol 5</th>
      <td>July 4th</td>
      <td>1.10</td>
      <td>0.43</td>
      <td>0.04</td>
      <td>1.41</td>
    </tr>
    <tr>
      <th>Hol 6</th>
      <td>Labor Day</td>
      <td>0.21</td>
      <td>0.43</td>
      <td>0.03</td>
      <td>1.41</td>
    </tr>
    <tr>
      <th>Hol 7</th>
      <td>Columbus Day</td>
      <td>-0.04</td>
      <td>0.45</td>
      <td>0.21</td>
      <td>1.39</td>
    </tr>
    <tr>
      <th>Hol 8</th>
      <td>Veterans Day</td>
      <td>-0.15</td>
      <td>0.48</td>
      <td>0.03</td>
      <td>1.41</td>
    </tr>
    <tr>
      <th>Hol 9</th>
      <td>Thanksgiving</td>
      <td>0.14</td>
      <td>0.43</td>
      <td>0.16</td>
      <td>1.39</td>
    </tr>
    <tr>
      <th>Hol 10</th>
      <td>Christmas</td>
      <td>-1.97</td>
      <td>1.11</td>
      <td>-1.10</td>
      <td>1.23</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The largest negative coefficients are for Christmas and New Years Day, which means that they are more likely to have very low or $0$ sales.</p>
<p>The largest positive coefficients are for July 4th and Memorial day, which means that they are likely to have increased sales.</p>

</div>
</div>
</div>
</div>
 

