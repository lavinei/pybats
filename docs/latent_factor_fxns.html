---

title: Latent Factor Functions


keywords: fastai
sidebar: home_sidebar

summary: "This module contains the update and forecast functions to work with a latent factor DGLM. There are two sets of functions: The first works with the latent_factor class in PyBATS, which represents latent factors by a mean and a variance. The second set of functions relies on simulated values of a latent factor, which is a more precise but computationally slower method."
description: "This module contains the update and forecast functions to work with a latent factor DGLM. There are two sets of functions: The first works with the latent_factor class in PyBATS, which represents latent factors by a mean and a variance. The second set of functions relies on simulated values of a latent factor, which is a more precise but computationally slower method."
nb_path: "nbs/14_latent_factor_fxns.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/14_latent_factor_fxns.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The default functions work with the <a href="/pybats/latent_factor.html"><code>latent_factor</code></a> class, and are called automatically by <a href="/pybats/analysis.html#analysis"><code>analysis</code></a>, <a href="/pybats/dglm.html#dglm.update"><code>dglm.update</code></a>, <a href="/pybats/dglm.html#dglm.forecast_marginal"><code>dglm.forecast_marginal</code></a>, and <a href="/pybats/dglm.html#dglm.forecast_path"><code>dglm.forecast_path</code></a> when there are latent factors in the model.</p>
<p>To use simulated latent factor values, set the argument <code>analytic=False</code> in the <a href="/pybats/dglm.html"><code>dglm</code></a> methods, and pass in the set of simulated values as <code>phi_samps</code>. It is not currently supported to use the simulated latent factor values within <a href="/pybats/analysis.html#analysis"><code>analysis</code></a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Moment-based-latent-factor-analysis">Moment-based latent factor analysis<a class="anchor-link" href="#Moment-based-latent-factor-analysis"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="update_lf_analytic" class="doc_header"><code>update_lf_analytic</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/latent_factor_fxns.py#L29" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>update_lf_analytic</code>(<strong><code>mod</code></strong>, <strong><code>y</code></strong>=<em><code>None</code></em>, <strong><code>X</code></strong>=<em><code>None</code></em>, <strong><code>phi_mu</code></strong>=<em><code>None</code></em>, <strong><code>phi_sigma</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="update_lf_analytic_dlm" class="doc_header"><code>update_lf_analytic_dlm</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/latent_factor_fxns.py#L87" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>update_lf_analytic_dlm</code>(<strong><code>mod</code></strong>, <strong><code>y</code></strong>=<em><code>None</code></em>, <strong><code>X</code></strong>=<em><code>None</code></em>, <strong><code>phi_mu</code></strong>=<em><code>None</code></em>, <strong><code>phi_sigma</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="forecast_marginal_lf_analytic" class="doc_header"><code>forecast_marginal_lf_analytic</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/latent_factor_fxns.py#L163" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>forecast_marginal_lf_analytic</code>(<strong><code>mod</code></strong>, <strong><code>k</code></strong>, <strong><code>X</code></strong>=<em><code>None</code></em>, <strong><code>phi_mu</code></strong>=<em><code>None</code></em>, <strong><code>phi_sigma</code></strong>=<em><code>None</code></em>, <strong><code>nsamps</code></strong>=<em><code>1</code></em>, <strong><code>mean_only</code></strong>=<em><code>False</code></em>, <strong><code>state_mean_var</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="forecast_path_lf_copula" class="doc_header"><code>forecast_path_lf_copula</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/latent_factor_fxns.py#L189" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>forecast_path_lf_copula</code>(<strong><code>mod</code></strong>, <strong><code>k</code></strong>, <strong><code>X</code></strong>=<em><code>None</code></em>, <strong><code>phi_mu</code></strong>=<em><code>None</code></em>, <strong><code>phi_sigma</code></strong>=<em><code>None</code></em>, <strong><code>phi_psi</code></strong>=<em><code>None</code></em>, <strong><code>nsamps</code></strong>=<em><code>1</code></em>, <strong><code>t_dist</code></strong>=<em><code>False</code></em>, <strong><code>y</code></strong>=<em><code>None</code></em>, <strong><code>nu</code></strong>=<em><code>9</code></em>, <strong><code>return_mu_cov</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These functions are called automatically in PyBATS when working with a DGLM that has a latent factor component. The new arguments are:</p>
<ul>
<li><code>phi_mu</code>: Mean vector of the latent factor. For <a href="/pybats/latent_factor_fxns.html#forecast_path_lf_copula"><code>forecast_path_lf_copula</code></a>, it should be a list of <code>k</code> mean vectors.</li>
<li><code>phi_sigma</code>: Variance matrix of the latent factor. For <a href="/pybats/latent_factor_fxns.html#forecast_path_lf_copula"><code>forecast_path_lf_copula</code></a>, it should be a list of <code>k</code> variance matrices.</li>
</ul>
<p>The following extra arguments are only applicable to path forecasting with <a href="/pybats/latent_factor_fxns.html#forecast_path_lf_copula"><code>forecast_path_lf_copula</code></a>:</p>
<ul>
<li><code>phi_psi</code>: This is a list of <code>k-1</code> covariance matrices $cov(\phi_{t+k}, \phi_{t+j})$. Each element is a numpy array.</li>
<li><code>t_dist</code>: Boolean. By default, a Gaussian copula is used. If True, then a t-copula is used instead.</li>
<li><code>y</code>: Future path of observations y. If provided, output will be the forecast density of y.</li>
<li><code>nu</code>: Degrees of freedom for t-copula.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Simulation-based-latent-factor-analysis">Simulation-based latent factor analysis<a class="anchor-link" href="#Simulation-based-latent-factor-analysis"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="update_lf_sample" class="doc_header"><code>update_lf_sample</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/latent_factor_fxns.py#L249" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>update_lf_sample</code>(<strong><code>mod</code></strong>, <strong><code>y</code></strong>=<em><code>None</code></em>, <strong><code>X</code></strong>=<em><code>None</code></em>, <strong><code>phi_samps</code></strong>=<em><code>None</code></em>, <strong><code>parallel</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>DGLM update function with samples of a latent factor.</p>
<p>$\phi_{samps}$ = Array of simulated values of a latent factor.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="update_lf_sample_forwardfilt" class="doc_header"><code>update_lf_sample_forwardfilt</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/latent_factor_fxns.py#L303" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>update_lf_sample_forwardfilt</code>(<strong><code>mod</code></strong>, <strong><code>y</code></strong>, <strong><code>F</code></strong>, <strong><code>a</code></strong>, <strong><code>R</code></strong>, <strong><code>phi</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="forecast_marginal_lf_sample" class="doc_header"><code>forecast_marginal_lf_sample</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/latent_factor_fxns.py#L320" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>forecast_marginal_lf_sample</code>(<strong><code>mod</code></strong>, <strong><code>k</code></strong>, <strong><code>X</code></strong>=<em><code>None</code></em>, <strong><code>phi_samps</code></strong>=<em><code>None</code></em>, <strong><code>mean_only</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="forecast_path_lf_sample" class="doc_header"><code>forecast_path_lf_sample</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/latent_factor_fxns.py#L342" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>forecast_path_lf_sample</code>(<strong><code>mod</code></strong>, <strong><code>k</code></strong>, <strong><code>X</code></strong>=<em><code>None</code></em>, <strong><code>phi_samps</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These functions can be called through <a href="/pybats/dglm.html#dglm.update"><code>dglm.update</code></a>, <a href="/pybats/dglm.html#dglm.forecast_marginal"><code>dglm.forecast_marginal</code></a>, and <a href="/pybats/dglm.html#dglm.forecast_path"><code>dglm.forecast_path</code></a> by setting the argument <code>analytic=False</code>. They represent an alternative method of analysis by working with simulated values of the latent factor. The simulated values are passed into the function as an array <code>phi_samps</code>, where each row contains a simulated value of the latent factor.</p>
<p>This is a more accurate analysis method because it does not reduce the distribution of the latent factor down to its mean and variance. However, it is also more computationally demanding to work with the simulated values, so there is a trade-off between speed and accuracy.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Multivariate-forecasting-with-multiple-DGLMs">Multivariate forecasting with multiple DGLMs<a class="anchor-link" href="#Multivariate-forecasting-with-multiple-DGLMs"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="forecast_joint_marginal_lf_copula" class="doc_header"><code>forecast_joint_marginal_lf_copula</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/latent_factor_fxns.py#L396" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>forecast_joint_marginal_lf_copula</code>(<strong><code>mod_list</code></strong>, <strong><code>k</code></strong>, <strong><code>X_list</code></strong>=<em><code>None</code></em>, <strong><code>phi_mu</code></strong>=<em><code>None</code></em>, <strong><code>phi_sigma</code></strong>=<em><code>None</code></em>, <strong><code>nsamps</code></strong>=<em><code>1</code></em>, <strong><code>y</code></strong>=<em><code>None</code></em>, <strong><code>t_dist</code></strong>=<em><code>False</code></em>, <strong><code>nu</code></strong>=<em><code>9</code></em>, <strong><code>return_cov</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/pybats/latent_factor_fxns.html#forecast_joint_marginal_lf_copula"><code>forecast_joint_marginal_lf_copula</code></a> is used to <em>recouple</em> a set of DGLMs which share the same latent factor. In other words, if the same latent factor is used in multiple models, then their forecasts will be correlated. This function allows for joint forecasting across these separated DGLMs.</p>
<p>A classic example comes from retail sales. The latent factor may represent an effect at the total store level - say, customer traffic based on the day-of-week. A separate DGLM models the sales of each individual item. To jointly forecast the sales of many items, the models can all be passed into <a href="/pybats/latent_factor_fxns.html#forecast_joint_marginal_lf_copula"><code>forecast_joint_marginal_lf_copula</code></a>, along with the latent factor mean and variance, to draw joint samples from the forecast distribution.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Multivariate-forecasting-with-multiple-DCMMs">Multivariate forecasting with multiple DCMMs<a class="anchor-link" href="#Multivariate-forecasting-with-multiple-DCMMs"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="forecast_joint_marginal_lf_copula_dcmm" class="doc_header"><code>forecast_joint_marginal_lf_copula_dcmm</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/latent_factor_fxns.py#L452" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>forecast_joint_marginal_lf_copula_dcmm</code>(<strong><code>dcmm_list</code></strong>, <strong><code>k</code></strong>, <strong><code>X_list</code></strong>=<em><code>None</code></em>, <strong><code>phi_mu</code></strong>=<em><code>None</code></em>, <strong><code>phi_sigma</code></strong>=<em><code>None</code></em>, <strong><code>nsamps</code></strong>=<em><code>1</code></em>, <strong><code>t_dist</code></strong>=<em><code>False</code></em>, <strong><code>nu</code></strong>=<em><code>9</code></em>, <strong><code>return_cov</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/pybats/latent_factor_fxns.html#forecast_joint_marginal_lf_copula_dcmm"><code>forecast_joint_marginal_lf_copula_dcmm</code></a> behaves similarly to <a href="/pybats/latent_factor_fxns.html#forecast_joint_marginal_lf_copula"><code>forecast_joint_marginal_lf_copula</code></a>, but for a set of related DCMMs instead of related DGLMs.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="DCMM-forecast-functions">DCMM forecast functions<a class="anchor-link" href="#DCMM-forecast-functions"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="forecast_marginal_lf_dcmm" class="doc_header"><code>forecast_marginal_lf_dcmm</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/latent_factor_fxns.py#L521" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>forecast_marginal_lf_dcmm</code>(<strong><code>mod</code></strong>, <strong><code>k</code></strong>, <strong><code>X</code></strong>=<em><code>None</code></em>, <strong><code>phi_mu</code></strong>=<em><code>None</code></em>, <strong><code>phi_sigma</code></strong>=<em><code>None</code></em>, <strong><code>nsamps</code></strong>=<em><code>1</code></em>, <strong><code>t_dist</code></strong>=<em><code>False</code></em>, <strong><code>nu</code></strong>=<em><code>9</code></em>, <strong><code>return_cov</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="forecast_path_lf_dcmm" class="doc_header"><code>forecast_path_lf_dcmm</code><a href="https://github.com/lavinei/pybats/tree/master/pybats/latent_factor_fxns.py#L564" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>forecast_path_lf_dcmm</code>(<strong><code>mod</code></strong>, <strong><code>k</code></strong>, <strong><code>X</code></strong>=<em><code>None</code></em>, <strong><code>phi_mu</code></strong>=<em><code>None</code></em>, <strong><code>phi_sigma</code></strong>=<em><code>None</code></em>, <strong><code>phi_psi</code></strong>=<em><code>None</code></em>, <strong><code>nsamps</code></strong>=<em><code>1</code></em>, <strong><code>t_dist</code></strong>=<em><code>False</code></em>, <strong><code>nu</code></strong>=<em><code>9</code></em>, <strong><code>return_cov</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These functions are for marginal and path forecasting with a latent factor DCMM. They may be accessed as methods from <a href="/pybats/dcmm.html"><code>dcmm</code></a>.</p>

</div>
</div>
</div>
</div>
 

